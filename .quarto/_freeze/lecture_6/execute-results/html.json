{
  "hash": "5147ef4b4eef13d427a21219f371e8ca",
  "result": {
    "engine": "knitr",
    "markdown": "# Making map of Tokyo\n\nList of R packages used in this section:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(jpndistrict) # to get the base map of Japan's prefecture\nlibrary(ggthemes) # to use theme_map\nlibrary(rnaturalearth) # to use ne_countries\n```\n:::\n\n\n-   Alternatively, you can use the `pacman` package manager to load necessary R packages from below:\n\n\n::: {.cell}\n\n```{.txt .cell-code}\npacman::p_load(sf, tidyverse, jpndistrict, ggthemes, rnaturalearth)\n```\n:::\n\n\n-   Name the data world_map\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nglobal_map <- ne_countries(scale = \"small\", returnclass = \"sf\")\n```\n:::\n\n\n## Population Map of Tokyo\n\n-   The prefecture code for Tokyo is 13. Now we can plot the map of the 23 wards of Tokyo\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndf_tokyo_sf <- jpn_pref(13, district = TRUE) %>% \n  dplyr::filter(str_detect(city, \"区\")) \n```\n:::\n\n\n-   Display the extracted map of Tokyo's 23 wards\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndf_tokyo_sf %>%\n  ggplot() +\n  geom_sf() +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](lecture_6_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n-   Check your data here\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nhead(df_tokyo_sf, 23)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 23 features and 4 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 139.5636 ymin: 35.52086 xmax: 139.919 ymax: 35.81758\nGeodetic CRS:  WGS 84\n# A tibble: 23 × 5\n   pref_code prefecture city_code city                                  geometry\n   <chr>     <chr>      <chr>     <chr>                       <MULTIPOLYGON [°]>\n 1 13        東京都     13101     千代田区 (((139.7299 35.68555, 139.7333 35.67…\n 2 13        東京都     13102     中央区   (((139.7589 35.65892, 139.7646 35.65…\n 3 13        東京都     13103     港区     (((139.7714 35.62304, 139.7825 35.62…\n 4 13        東京都     13104     新宿区   (((139.6735 35.71852, 139.679 35.718…\n 5 13        東京都     13105     文京区   (((139.7174 35.71455, 139.7232 35.71…\n 6 13        東京都     13106     台東区   (((139.7632 35.72184, 139.7685 35.71…\n 7 13        東京都     13107     墨田区   (((139.8095 35.68689, 139.812 35.688…\n 8 13        東京都     13108     江東区   (((139.7715 35.61667, 139.7712 35.61…\n 9 13        東京都     13109     品川区   (((139.6954 35.60832, 139.6957 35.61…\n10 13        東京都     13110     目黒区   (((139.6664 35.61861, 139.6631 35.61…\n# ℹ 13 more rows\n```\n\n\n:::\n:::\n\n\n-   Import the .CSV data to make an interactive population map of Tokyo\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndf_tokyo_pop <- read_csv(\"data/csv/tokyo_pop.csv\")\n```\n:::\n\n\n-   Check your population data.\n\n    ![CSV population data of Tokyo](figures/14.1.jpg){width=\"250\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nhead(df_tokyo_pop)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  city     city_eng   population\n  <chr>    <chr>           <dbl>\n1 足立区   Adachi-ku      674067\n2 荒川区   Arakawa-ku     213648\n3 文京区   Bunkyō-ku      223389\n4 千代田区 Chiyoda-ku      59441\n5 中央区   Chūō-ku        147620\n6 江戸川区 Edogawa-ku     685899\n```\n\n\n:::\n:::\n\n\n-   Merge the spatial data with your population data\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nmerge_tokyo <- df_tokyo_sf %>% \n  left_join(df_tokyo_pop, by = \"city\") %>% \n  st_as_sf()\n```\n:::\n\n\n-   Check the merged data\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nmerge_tokyo %>% \n  head() %>% \n  rmarkdown::paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"pref_code\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"prefecture\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_code\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"geometry\"],\"name\":[5],\"type\":[\"s_MULTIP\"],\"align\":[\"right\"]},{\"label\":[\"city_eng\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"population\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"13\",\"2\":\"東京都\",\"3\":\"13101\",\"4\":\"千代田区\",\"5\":\"<s_MULTIP>\",\"6\":\"Chiyoda-ku\",\"7\":\"59441\"},{\"1\":\"13\",\"2\":\"東京都\",\"3\":\"13102\",\"4\":\"中央区\",\"5\":\"<s_MULTIP>\",\"6\":\"Chūō-ku\",\"7\":\"147620\"},{\"1\":\"13\",\"2\":\"東京都\",\"3\":\"13103\",\"4\":\"港区\",\"5\":\"<s_MULTIP>\",\"6\":\"Minato-ku\",\"7\":\"248071\"},{\"1\":\"13\",\"2\":\"東京都\",\"3\":\"13104\",\"4\":\"新宿区\",\"5\":\"<s_MULTIP>\",\"6\":\"Shinjuku-ku\",\"7\":\"339211\"},{\"1\":\"13\",\"2\":\"東京都\",\"3\":\"13105\",\"4\":\"文京区\",\"5\":\"<s_MULTIP>\",\"6\":\"Bunkyō-ku\",\"7\":\"223389\"},{\"1\":\"13\",\"2\":\"東京都\",\"3\":\"13106\",\"4\":\"台東区\",\"5\":\"<s_MULTIP>\",\"6\":\"Taitō-ku\",\"7\":\"200486\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n-   Plot your data with ggplot2\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nmap_pop_tokyo <- merge_tokyo %>% \n  ggplot() +\n  geom_sf(aes(fill = population)) +\n  scale_fill_distiller(name = \"Population\",\n                       palette = \"Greens\", direction = 1) +\n  theme_map(base_family = \"HiraginoSans-W3\") +\n  theme(legend.position = c(.1, -.1),\n        legend.direction = \"horizontal\",\n        legend.title = element_text(size = 15), \n        legend.text = element_text(size = 15),\n        legend.key.size = unit(1, \"cm\"),\n        legend.key.width = unit(3,\"cm\")) +\n  coord_sf(datum = NA) \n\nmap_pop_tokyo\n```\n\n::: {.cell-output-display}\n![Population of Tokyo, Japan](lecture_6_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n-   Plot your population data with the name of the cities in Tokyo\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nmap_pop_tokyo_text <- merge_tokyo %>% \n  mutate(\n    text_x = map_dbl(geometry, ~st_centroid(.x)[[1]]),\n    text_y = map_dbl(geometry, ~st_centroid(.x)[[2]])\n  ) %>% \n  ggplot() +\n  geom_sf(aes(fill = population)) +\n  geom_label(aes(x = text_x, y = text_y, label = city), \n             size = 1.7, family = \"HiraginoSans-W3\") +\n  scale_fill_distiller(name = \"Population\",\n                       palette = \"Greens\", direction = 1) +\n  theme_map(base_family = \"HiraginoSans-W3\") +\n  theme(legend.position = c(.8, .05),\n        legend.title = element_text(size = 10), \n        legend.text = element_text(size = 5),\n        legend.key.size = unit(0.5, \"cm\"),\n        legend.key.width = unit(1,\"cm\")) +\n  coord_sf(datum = NA) \n\nmap_pop_tokyo_text\n```\n\n::: {.cell-output-display}\n![Population of Tokyo, Japan](lecture_6_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n-   To export the above figure, use the following code:\n\n```         \nggsave(\"fig/map_pop_tokyo_text.png\", map_pop_tokyo_text, width = 13, height = 13)\n```\n",
    "supporting": [
      "lecture_6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}